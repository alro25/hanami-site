<div class="home-container">
    <app-side-modal [isOpen]="uiService.isCartOpen()" (close)="uiService.closeAllModals()" position="right">
      <div class="cart-header">
        <h2>Seu Carrinho</h2>
        <span>({{ cartService.itemCount() }} itens)</span>
      </div>

      @if (cartService.cartItems().length > 0) {
        <div class="cart-items">
          @for (item of cartService.cartItems(); track item.product.id) {
            <div class="cart-item">
              <img [ngSrc]="item.product.imageUrl" width="80" height="80" [alt]="item.product.name">
              <div class="item-info">
                <p class="item-name">{{ item.product.name }}</p>
                <div class="item-controls">
                  <div class="quantity-selector">
                    <button (click)="cartService.updateQuantity(item.product.id, -1)" aria-label="Remover uma unidade">-</button>
                    <span>{{ item.quantity }}</span>
                    <button (click)="cartService.updateQuantity(item.product.id, 1)" aria-label="Adicionar uma unidade">+</button>
                  </div>
                  <button class="remove-btn" (click)="cartService.removeFromCart(item.product.id)">Remover</button>
                </div>
              </div>
              <div class="item-price">
                <p>R$ {{ (item.product.price * item.quantity).toFixed(2) }}</p>
              </div>
            </div>
          }
        </div>
        <div class="cart-footer">
          <div class="subtotal">
            <span>Subtotal</span>
            <strong>R$ {{ cartService.cartTotal().toFixed(2) }}</strong>
          </div>
          <button class="btn btn-dark checkout-btn" (click)="cartService.checkout()">Finalizar Compra</button>
        </div>
      } @else {
        <div class="cart-empty">
          <p>Seu carrinho est√° vazio.</p>
          <button class="btn btn-outline" (click)="uiService.closeAllModals()">Continuar Comprando</button>
        </div>
      }
    </app-side-modal>
    
    <app-side-modal [isOpen]="uiService.isSearchOpen()" (close)="uiService.closeAllModals()" position="right">
      <h2>Pesquisar Produtos</h2>
      <input type="search" placeholder="O que voc√™ procura?" style="width: 100%; padding: 0.5rem;"/>
    </app-side-modal>

    <app-side-modal [isOpen]="uiService.isProfileOpen()" (close)="uiService.closeAllModals()" position="right">
      <h2>Minha Conta</h2>
      
      @if (authService.isAuthenticated()) {
        <!-- User is LOGGED IN -->
        <p style="margin-bottom: 15px; color: #666; text-align: center;">
          Ol√°, <strong>{{ authService.getUsername() }}</strong>!
        </p>
        <a href="#" (click)="goToDashboard($event)" class="modal-link">
          üìä Acessar Dashboard
        </a>
        <br>
        <button class="btn btn-outline logout-btn" (click)="logout()">
          üö™ Sair
        </button>
      } @else {
        <!-- User is NOT logged in -->
        <a href="#" (click)="goToLogin($event)" class="modal-link">
          üîë Fazer Login
        </a>
        <br>
        <a href="#" class="modal-link" (click)="$event.preventDefault(); uiService.closeAllModals()">
          üìù Criar Conta
        </a>
      }
    </app-side-modal>

    
  <header class="main-header">
    <div class="header-top">
      <div class="logo">
        <h1>HANAMI</h1>
      </div>
      
      <div class="nav-icons">
        <a href="#" aria-label="Search" (click)="$event.preventDefault(); uiService.toggleSearch()">
          <span class="icon">
            <img ngSrc="/img/busca-icon.png" alt="Buscar" width="24" height="24">
          </span>
        </a>
        <a href="#" aria-label="User Account" (click)="$event.preventDefault(); uiService.toggleProfile()">
          <span class="icon">
            <img ngSrc="/img/usuario-icon.png" alt="Minha Conta" width="24" height="24">
          </span>
        </a>
        <a href="#" aria-label="Shopping Cart" (click)="$event.preventDefault(); uiService.toggleCart()" class="cart-icon">
          <span class="icon">
            <img ngSrc="/img/sacola-icon.png" alt="Carrinho" width="24" height="24">
            @if (cartService.itemCount() > 0) {
              <span class="cart-badge">{{ cartService.itemCount() }}</span>
            }
          </span>
        </a>
      </div>
    </div>

    <div class="nav-links">
      @for(link of getNavLinks(); track link) {
        <div class="nav-item" (mouseenter)="activeMenu.set(link)" (mouseleave)="activeMenu.set(null)">
          <a href="#">{{ link }}</a>
          @if (activeMenu() === link) {
            <div class="submenu">
              @for (sublink of getSubmenu(link); track sublink) {
                <a href="#">{{ sublink }}</a>
              }
            </div>
          }
        </div>
      }
    </div>
  </header>

  <main>

   <section class="hero-carousel">
      <div class="slides-container">
        @for (slide of slides; track slide.imageUrl; let i = $index) {
          <div class="slide" [class.active]="i === currentIndex()">
            <img [ngSrc]="slide.imageUrl" [alt]="slide.alt" fill priority="{{ i === 0 ? 'true' : 'false' }}">
            <div class="slide-content">
              <h2>{{ slide.title }}</h2>
              <p>{{ slide.subtitle }}</p>
              <button class="btn btn-dark">VER NOVIDADES</button>
            </div>
          </div>
        }
      </div>

      <button class="carousel-arrow left" (click)="goToPrevious()" aria-label="Slide anterior">‚Äπ</button>
      <button class="carousel-arrow right" (click)="goToNext()" aria-label="Pr√≥ximo slide">‚Ä∫</button>

      <div class="carousel-dots">
        @for (slide of slides; track slide.imageUrl; let i = $index) {
          <button 
            (click)="goToSlide(i)"
            [class.active]="i === currentIndex()"
            [attr.aria-label]="'Ir para o slide ' + (i + 1)">
          </button>
        }
      </div>
    </section>

    <section class="popular-products">
      <h2>Populares</h2>
      <div class="products-carousel">
        <div class="product-grid">
          @for (product of popularProducts(); track product.id) {
            <div class="product-card">
              <div class="product-image-placeholder">
                <img [ngSrc]="product.imageUrl" [alt]="product.name" width="250" height="300" style="object-fit: cover;">
              </div>
              <h3>{{ product.name }}</h3>
              <p>R$ {{ product.price.toFixed(2) }}</p>
              <button class="btn btn-dark" (click)="onAddToCart(product)">COMPRAR</button>
            </div>
          }
        </div>
        </div>
      <button class="btn btn-outline">VER MAIS</button>
    </section>

    <!-- First promo with background -->
    <div class="promo-background gloss-background">
      <section class="promo-section gloss-promo">
        <div class="promo-text">
          <h2>CONHE√áA O GLOSS PASSIONFRUIT</h2>
          <p>A fus√£o perfeita entre brilho intenso e frescor tropical. <br>Com textura leve e acabamento luminoso, ele real√ßa os l√°bios com um toque ex√≥tico e irresist√≠vel. <br>Ideal para quem quer seduzir com naturalidade e sofistica√ß√£o.</p>
          <button class="btn btn-dark">VER MAIS</button>
        </div>
        <div class="promo-image">
          <img src="/img/passion-fruit.png" width="600" height="600" alt="Gloss Passionfruit product">
        </div>
      </section>
    </div>

    <!-- Second promo with background -->
    <div class="promo-background lipstick-background">
      <section class="promo-section lipstick-promo image-first">
        <div class="promo-text">
          <h2>CONHE√áA A LINHA PAPILLON LIPSTICK</h2>
          <p>Cores intensas e acabamento aveludado para l√°bios que contam hist√≥rias. Cada aplica√ß√£o revela personalidade, atitude e sofistica√ß√£o. A longa dura√ß√£o que voc√™ ama, com o conforto que voc√™ merece ‚Äî sem ressecar, sem borrar.</p>
          <button class="btn btn-dark">VER MAIS</button>
        </div>
        <div class="promo-image">
          <img src="https://i.imgur.com/V2zV9pI.png" width="600" height="600" alt="Papillon Lipstick products">
        </div>
      </section>
    </div>

  </main>

  <footer class="main-footer">
    <div class="footer-column">
      <h4>Sobre n√≥s</h4>
      <a href="#">Quem somos</a>
      <a href="#">Carreiras</a>
      <a href="#">Pol√≠tica de Privacidade</a>
    </div>
    <div class="footer-column">
      <h4>Fale conosco</h4>
      <p> (99)99999-9999</p>
      <p> contato&#64;hanami.com</p>
      <a routerLink="/contato" target="_blank">Contate-nos</a>
    </div>
    <div class="footer-column">
      <h4>Redes Sociais</h4>
      <div class="social-icons">
        <a href="#" aria-label="Instagram">
          <img ngSrc="/img/instagram-icon.png" alt="√çcone do Instagram" width="28" height="28">
        </a>
        <a href="#" aria-label="youtube">
          <img ngSrc="/img/youtube-icon.png" alt="√çcone do Youtube" width="28" height="28">
        </a>
        <a href="#" aria-label="">
          <img ngSrc="/img/facebook-icon.png" alt="√çcone do Facebook" width="28" height="28">
        </a>
      </div>
    </div>
  </footer>

</div>